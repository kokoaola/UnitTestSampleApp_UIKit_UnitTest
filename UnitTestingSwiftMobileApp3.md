## コードカバレッジ
- コードカバレッジ（Code Coverage）とは、テストがカバーするコードの割合や範囲を測定する指標のこと。どの部分がテストされているのか、またどの部分がテストされていないのかを示す。

- コードカバレッジの種類：
  - 行カバレッジ（Line Coverage）: テスト中に実行されたコードの行数の割合を示す
  ブランチカバレッジ（Branch Coverage）: テストがすべての可能な分岐（if文やswitch文など）を実行したかどうかを示す割合
  - 関数カバレッジ（Function Coverage）: テストがどれだけの関数やメソッドを実行したかの割合を示す
  - ステートメントカバレッジ（Statement Coverage）: テストが実行したステートメントの割合を示す
- コードのカバー率
iOS開発ではカバー率85%くらいが一般的。カバー率が高くても重要なテストケースが欠落している場合もあり、カバー率だけではテストの品質を評価できない。
ユニットテストを一つ行ったのみで終わりにするのはNG。一つの機能に対して、考えられるパターンの複数のテストをおこなうことが必要。ユーザーの潜在的なバグが隠れている場合もあり、
### 設定方法
スキーマを選択 - Test - Test Plansにカーソルを持って行った時に出現する右向きの矢印をクリック - Configurations - Code Coverageを探してOnにする - Testを実行する
### コードカバレッジの確認方法
Testを実行後、Test Navigatorのテストのログのグラフから、カバーされたコードの量が確認できる
右向き矢印からソースコードのファイルに飛ぶと、右側の小さな数字で関数のユニットテストが実行された回数を確認できる、ゼロの場合は赤くなる


## Arrange Act Assert(AAA)
ユニットテストのコードの記述をする時の共通のパターンのこと。アレンジとも呼ばれる。メソッドが何をテストしようとしているのかをより簡単に理解できる
- Arrange(調整)ブロック
  - テストに必要な変数を全て記述する
- Act(行動)
  - テスト対象のメソッドを呼び出す、結果を変数に格納する
- Assert(主張)
  - テストアサーションを使用し、テストをパスしたか検証する

### テストアサーションの種類
#### Boolean Test Assertions
結果が真であるか、偽であるかを確認するテスト
- XCTAssertTrue(テスト結果を格納したBool値の変数, "テスト不合格の時に表示されるメッセージ")
  - 式が真ならテストメソッド合格
  - メッセージはオプションだが、テストの効率を考えると入れておいた方がいい
  - オプションとして、XCTAssertTrue(変数, "メッセージ", file: "xxxx.swift", line:35)みたいに、テスト不合格時にログで表示されるファイル名と行数を指定できる。指定されていない場合、Xcodeは実際のテストケースのファイル名と行数を表示する
- XCTAssertFalse(変数, "メッセージ")
  - 式が偽ならテストメソッド合格
  - それ以外はXCTAssertTrueと同じ
#### Nil Test Assertions
結果がnilであるか、もしくはnilではないことを確認するテスト
- XCTAssertNil(テスト結果を格納した変数, "メッセージ")
  - 式の結果がnilになれば合格
- XCTAssertNotNil(テスト結果を格納した変数, "メッセージ")
  - 式の結果がnilではなければ合格
- XCTUnwrap
  - オプショナル値がnilでないことをアサートし、アンラップされた値を返す
  - オプショナル値がnilの場合、テストは失敗
  - クラッシュを回避してテストを実行できる
  - アンラップされた値は、後続のテストコードで使用できる
```swift
let value = try XCTUnwrap(optionalValue, "The optionalValue should not be nil")
```
#### Equality Test Assertions
２つの値を比較するためのテスト
- XCTAssertEqual(value1, value2, "メッセージ")
  - 二つの値やオブジェクトが等しいことを確認する
- XCTAssertNotEqual(value1, value2, "メッセージ")
  - 二つの値やオブジェクトが等しくないことを確認する
- XCTAssertGreaterTan(value1, value2, "メッセージ")
  - 第一の値が第二の値よりも大きいことを確認する
- XCTAssertLessThan(value1, value2, "メッセージ")
  - 第一の値が第二の値よりも小さいことを確認する
- XCTAssertLessThanOrEqual(value1, value2, "メッセージ")
  - 第一の値が第二の値以下であることを確認する
- XCTAssertEqualWithAccuracy(value1, value2, 誤差の精度, "メッセージ")
  -  二つの値が許容する誤差の範囲内で等しいことを確認する

#### その他
- XCTFail
  - 無条件でテストを失敗させる
- XCTAssertThrowsError 
  - 特定のコードがエラーを投げること（throw）を確認するテスト
  - エラーがスローされれば合格
- XCTAssertNoThrowsError 
   - 特定のコードがエラーを投げないことを確認するテスト
 



## テストが失敗したら？
ユニットテストのコード、テストのアサーション、入力値などが間違っていないか確認
- デバッガーでアサーションが失敗した直後にトリガーされる特殊なブレークポイントを作成して確認
  - 左上の矢印みたいなボタンをクリック - ＋からTestFailureBreakpointを追加 - テストが失敗した段階で実行が停止され、失敗が起きた箇所が緑になる
- コードの関数を呼び出すテストメソッドを特定するには、関数の中にカーソルを置き中央左上の四角４つのアイコンをクリック - TestCalls - 呼び出す全てのテストメソッドが表示される


<!-- ## 並列分散テスト
- XCodeの機能で、複数のシュミレータークローンを使用して膨大なテストを高速で行う。互いのクローンシュミレーター間では、データ等は共有しない
- デフォルトでは、Xcodeはテストケースを実行するシミュレーターの数を自動的に決定する。数を変更するにはメニューバーのXCode - Setting - General - SimulatorTestParallelizationでシュミレーターの数を指定する - スキームを選択 - Edit - Test - Info - ちょっとわからなかった -->


## テスト駆動開発実践：バリデータークラスで実装していく
### バリデータークラスとは
- バリデータークラス：プログラミングにおいて入力データが特定のルールや制約を満たしているかをチェックする役割を持つクラス。
- 「ユーザーが個人情報、パスワードを入力 - サーバーに送信」のフローの間に、入力された情報が正しいか判断し、正しい場合のみ情報をサーバーに送る。
- バリデータークラスが正しく機能しているかテストするのがバリデーターテスト

### 導入手順


- テストの導入
  - Newfile - UnitTestCaseClass - 名前SignupFormModelValidatorを入力(末尾はTestsが望ましい) - ターゲットはプロジェクト名Testが選ばれていることを確認してCreate

- テスト対象となるクラスを作成SignupFormModelValidator

- テストの作成の準備
  - testPerformanceExampleを削除(パフォーマンステストをする場合は残す)、testExampleを削除（自分で１から作るので）
  - @testable import プロジェクト名を記述

- テストメソッドの作成（testから始まるメソッド名、命名方法は上を参照）
  - Arrange(テストに必要な変数を全て記述する)を記述
  - Act(テスト対象のメソッドを呼び出す、結果を変数に格納する)を記述
  - コンパイルしてみる(エラーなくコンパイルされるはず)
  - Assert(テストアサーションを使用し、テストをパスしたか検証する)でテスト合格となるアサーションを記述
  - Testを実行して失敗したことを確認する

- メソッドの作成（testから始まるメソッド名、命名方法は上を参照）  
  - テスト対象となるクラスに、テストメソッドをパスするコードを記述する


  - Testを実行する
